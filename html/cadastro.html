<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro</title>
  <link rel="stylesheet" href="../css/cadastro.css">
  <style>
    .error {
      color: red;
      font-size: 0.9em;
    }
    input {
      display: block;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

  <header class="navbar">
    <div class="logo">GOLDEN ERA</div>
  </header>

  <div class="container">
    <h1>Faça seu Cadastro</h1>
    <form id="cadastroForm">
      <label for="nome">Nome Completo</label>
      <input type="text" id="nome" name="nome">
      <span class="error" id="erroNome"></span>

      <label for="cpf">CPF</label>
      <input type="text" id="cpf" name="cpf" placeholder="000.000.000-00">
      <span class="error" id="erroCpf"></span>

      <label for="telefone">Telefone</label>
      <input type="tel" id="telefone" name="telefone">
      <span class="error" id="erroTelefone"></span>

      <label for="email">E-mail</label>
      <input type="email" id="email" name="email">
      <span class="error" id="erroEmail"></span>

      <label for="cidade">Cidade</label>
      <input type="text" id="cidade" name="cidade">
      <span class="error" id="erroCidade"></span>

      <label for="endereco">Endereço</label>
      <input type="text" id="endereco" name="endereco">
      <span class="error" id="erroEndereco"></span>

      <label for="senha">Senha</label>
      <input type="password" id="senha" name="senha">
      <span class="error" id="erroSenha"></span>

      <label for="confirmarSenha">Confirmar Senha</label>
      <input type="password" id="confirmarSenha" name="confirmarSenha">
      <span class="error" id="erroConfirmarSenha"></span>

      <input type="submit" value="Cadastrar-se">
      <span class="error" id="erroCadastro"></span>
    </form>
  </div>

  <script>
document.getElementById("cadastroForm").addEventListener("submit", async function(event) {
    event.preventDefault();

    let valid = true;
    document.querySelectorAll(".error").forEach(el => el.textContent = "");

    const nome = document.getElementById("nome").value.trim();
    const cpf = document.getElementById("cpf").value.trim();
    const telefone = document.getElementById("telefone").value.trim();
    const email = document.getElementById("email").value.trim();
    const cidade = document.getElementById("cidade").value.trim();
    const endereco = document.getElementById("endereco").value.trim();
    const senha = document.getElementById("senha").value;
    const confirmarSenha = document.getElementById("confirmarSenha").value;

    const cpfRegex = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (nome === "") {
        document.getElementById("erroNome").textContent = "O nome é obrigatório.";
        valid = false;
    }
    if (!cpfRegex.test(cpf)) {
        document.getElementById("erroCpf").textContent = "CPF inválido.";
        valid = false;
    }
    if (telefone === "") {
        document.getElementById("erroTelefone").textContent = "O telefone é obrigatório.";
        valid = false;
    }
    if (!emailRegex.test(email)) {
        document.getElementById("erroEmail").textContent = "E-mail inválido.";
        valid = false;
    }
    if (cidade === "") {
        document.getElementById("erroCidade").textContent = "A cidade é obrigatória.";
        valid = false;
    }
    if (endereco === "") {
        document.getElementById("erroEndereco").textContent = "O endereço é obrigatório.";
        valid = false;
    }
    if (senha.length < 6) {
        document.getElementById("erroSenha").textContent = "Senha com no mínimo 6 caracteres.";
        valid = false;
    }
    if (senha !== confirmarSenha) {
        document.getElementById("erroConfirmarSenha").textContent = "As senhas não coincidem.";
        valid = false;
    }

    if (valid) {
        const usuario = {
            nome,
            cpf,
            telefone,
            email,
            cidade,
            endereco,
            senha
        };

        try {
            const resposta = await fetch("http://localhost:5000/usuarios", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(usuario)
            });

            if (resposta.ok) {
                alert("Cadastro realizado com sucesso!");
                window.location.href = "login.html";
            } else if (resposta.status === 409) {
                document.getElementById("erroEmail").textContent = "E-mail já cadastrado.";
            } else {
                alert("Erro ao cadastrar. Tente novamente.");
            }
        } catch (erro) {
            alert("Erro ao conectar com o servidor.");
            console.error(erro);
        }
    }
});
    </script>


</body>
</html>
